<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时区测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .time-display {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }
        .time-item {
            flex: 1;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .local-time { background-color: #e3f2fd; }
        .utc-time { background-color: #fff3e0; }
        .beijing-time { background-color: #e8f5e8; }
        .current-date { background-color: #fce4ec; }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .highlight {
            background-color: #ffeb3b !important;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>金币记录器时区测试</h1>
        <p>这个测试页面用于验证程序是否正确使用北京时间</p>

        <div class="time-display">
            <div class="time-item local-time">
                <h3>本地时间</h3>
                <div id="localTime"></div>
                <div id="localDate"></div>
            </div>
            <div class="time-item utc-time">
                <h3>UTC时间</h3>
                <div id="utcTime"></div>
                <div id="utcDate"></div>
            </div>
            <div class="time-item beijing-time">
                <h3>北京时间</h3>
                <div id="beijingTime"></div>
                <div id="beijingDate"></div>
            </div>
            <div class="time-item current-date">
                <h3>程序当前日期</h3>
                <div id="currentDate"></div>
                <div id="currentBeijingDate"></div>
            </div>
        </div>

        <div>
            <button onclick="updateTimes()">刷新时间</button>
            <button onclick="testBeijingDate()">测试北京时间日期</button>
            <button onclick="testYesterday()">测试昨天日期</button>
            <button onclick="compareMethods()">对比不同方法</button>
        </div>

        <div id="testResults" style="margin-top: 20px; padding: 15px; background-color: #f0f0f0; border-radius: 4px;"></div>
    </div>

    <script>
        // 金币记录器的北京时间函数
        function getBeijingDate() {
            const now = new Date();
            console.log('当前UTC时间:', now.toISOString());

            // 北京时间是UTC+8，偏移量为8小时（毫秒）
            const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            console.log('计算后的北京时间:', beijingTime.toISOString());

            return beijingTime.toISOString().split('T')[0];
        }

        function getBeijingYesterdayDate() {
            const today = getBeijingDate();
            const date = new Date(today + 'T00:00:00+08:00');
            date.setDate(date.getDate() - 1);
            return date.toISOString().split('T')[0];
        }

        // 标准北京时间计算方法
        function getStandardBeijingDate() {
            const now = new Date();
            // 方法1: 使用Intl API（推荐）
            const beijingTime1 = new Intl.DateTimeFormat('zh-CN', {
                timeZone: 'Asia/Shanghai',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).format(now);

            // 方法2: 手动计算
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const beijingTime2 = new Date(utc + (8 * 60 * 60 * 1000));

            console.log('方法1 (Intl):', beijingTime1);
            console.log('方法2 (手动):', beijingTime2.toISOString().split('T')[0]);
            console.log('当前方法:', getBeijingDate());

            return beijingTime2.toISOString().split('T')[0];
        }

        function updateTimes() {
            const now = new Date();

            // 本地时间
            document.getElementById('localTime').textContent = now.toLocaleTimeString('zh-CN');
            document.getElementById('localDate').textContent = now.toLocaleDateString('zh-CN');

            // UTC时间
            document.getElementById('utcTime').textContent = now.toISOString().split('T')[1].split('.')[0];
            document.getElementById('utcDate').textContent = now.toISOString().split('T')[0];

            // 北京时间
            const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            document.getElementById('beijingTime').textContent = beijingTime.toLocaleTimeString('zh-CN');
            document.getElementById('beijingDate').textContent = beijingTime.toLocaleDateString('zh-CN');

            // 当前程序日期
            document.getElementById('currentDate').textContent = now.toISOString().split('T')[0];
            document.getElementById('currentBeijingDate').textContent = getBeijingDate();
        }

        function testBeijingDate() {
            const results = document.getElementById('testResults');
            const now = new Date();
            const beijingDate = getBeijingDate();

            let result = '<h3>北京时间日期测试结果：</h3>';
            result += `<p>当前UTC时间：${now.toISOString()}</p>`;
            result += `<p>程序计算的北京时间日期：${beijingDate}</p>`;

            // 检查是否正确
            const expectedBeijing = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            const expectedDate = expectedBeijing.toISOString().split('T')[0];

            if (beijingDate === expectedDate) {
                result += '<p style="color: green;">✅ 北京时间日期计算正确！</p>';
            } else {
                result += '<p style="color: red;">❌ 北京时间日期计算错误！</p>';
                result += `<p>期望结果：${expectedDate}</p>`;
            }

            results.innerHTML = result;
        }

        function testYesterday() {
            const results = document.getElementById('testResults');
            const yesterdayBeijing = getBeijingYesterdayDate();

            let result = '<h3>昨天日期测试结果：</h3>';
            result += `<p>程序计算的昨天北京时间日期：${yesterdayBeijing}</p>`;

            const today = getBeijingDate();
            const todayDate = new Date(today + 'T00:00:00+08:00');
            const yesterdayDate = new Date(todayDate);
            yesterdayDate.setDate(yesterdayDate.getDate() - 1);
            const expectedYesterday = yesterdayDate.toISOString().split('T')[0];

            result += `<p>期望的昨天日期：${expectedYesterday}</p>`;

            if (yesterdayBeijing === expectedYesterday) {
                result += '<p style="color: green;">✅ 昨天日期计算正确！</p>';
            } else {
                result += '<p style="color: red;">❌ 昨天日期计算错误！</p>';
            }

            results.innerHTML = result;
        }

        function compareMethods() {
            const results = document.getElementById('testResults');
            const now = new Date();

            let result = '<h3>不同北京时间计算方法对比：</h3>';

            // 方法1: 当前使用的简化方法
            const method1 = getBeijingDate();

            // 方法2: 使用Intl API（推荐）
            const beijingTime1 = new Intl.DateTimeFormat('zh-CN', {
                timeZone: 'Asia/Shanghai',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).format(now).replace(/\//g, '-');

            // 方法3: 更准确的手动计算
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const beijingTime3 = new Date(utc + (8 * 60 * 60 * 1000));
            const method3 = beijingTime3.toISOString().split('T')[0];

            // 方法4: 直接设置时区偏移
            const method4 = new Date(now.getTime() + (8 * 60 * 60 * 1000)).toISOString().split('T')[0];

            result += `<p><strong>当前UTC时间:</strong> ${now.toISOString()}</p>`;
            result += `<p><strong>时区偏移:</strong> ${now.getTimezoneOffset()} 分钟</p>`;
            result += `<p><strong>方法1 (当前程序):</strong> ${method1}</p>`;
            result += `<p><strong>方法2 (Intl API):</strong> ${beijingTime1}</p>`;
            result += `<p><strong>方法3 (标准手动):</strong> ${method3}</p>`;
            result += `<p><strong>方法4 (简化手动):</strong> ${method4}</p>`;

            // 判断哪种方法正确
            const correctMethod = method3; // 以标准手动计算为准
            const methods = [
                { name: '方法1', value: method1 },
                { name: '方法2', value: beijingTime1 },
                { name: '方法3', value: method3 },
                { name: '方法4', value: method4 }
            ];

            result += '<h4>正确性判断：</h4>';
            methods.forEach(method => {
                if (method.value === correctMethod) {
                    result += `<p style="color: green;">✅ ${method.name}: 正确</p>`;
                } else {
                    result += `<p style="color: red;">❌ ${method.name}: 错误 (期望: ${correctMethod})</p>`;
                }
            });

            results.innerHTML = result;
        }

        // 页面加载时立即更新时间
        updateTimes();

        // 每秒更新时间
        setInterval(updateTimes, 1000);
    </script>
</body>
</html>
